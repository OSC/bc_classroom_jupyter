<%-
  groups = OodSupport::User.new.groups.sort_by(&:id).tap do |groups|
    groups.unshift(groups.delete(OodSupport::Process.group))
  end.map(&:name).grep(/^P./)

  classrooms = OodAppkit.clusters.each_with_object({}) do |cluster, hash|
    if cluster.kubernetes?
      hash.merge!(cluster.custom_config[:classrooms].to_h)
    end
  end.select do |k,v|
    k.start_with?('jupyter') && groups.include?(v)
  end.map do |k,v|
    [ k.gsub('jupyter/', ''), v ]
  end
-%>
---
form:
  - cluster
  - classroom
  - account
  - jupyterlab_switch
  - bc_num_hours
  - num_cores
attributes:
  cluster:
    - "kubernetes"
    - "kubernetes-test"
    - "kubernetes-dev"
  account:
    widget: "hidden_field"
  jupyterlab_switch:
    widget: "check_box"
    label: "Use JupyterLab instead of Jupyter Notebook?"
    help: |
      JupyterLab is the next generation of Jupyter, and is completely compatible with existing Jupyter Notebooks.
  num_cores:
    widget: "number_field"
    label: "Number of cores"
    value: 1
    help: |
      Number of cores on node type (4 GB per core unless requesting whole
      node). Leave blank if requesting full node.
    min: 1
    max: 8
    step: 1
  <%- if classrooms.size >= 1 -%>
  classroom:  
    widget: select
    options:
      <%- classrooms.each do |key, value| %>
      - [
        "<%= key.gsub('_', ' ') %>", "<%= key %>",
        data-set-account: "<%= value %>"
        ]
      <%- end %>
  <%- end -%>
